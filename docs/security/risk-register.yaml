version: "1.0.0"
last_updated: "2026-01-03"
review_cycle: quarterly

# Risk Register for Acode - Agentic Coding Bot
# Organized by STRIDE categories (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege)
# Each risk scored using DREAD methodology (Damage, Reproducibility, Exploitability, Affected Users, Discoverability)
# DREAD scale: 1-10 for each factor, aggregated for severity classification

risks:
  # ===================================================================
  # SPOOFING RISKS (RISK-S-001 to RISK-S-006)
  # ===================================================================

  - id: RISK-S-001
    category: spoofing
    title: Malicious LLM impersonating local model
    description: |
      In Burst mode, if an attacker controls DNS or network routing, they could redirect
      LLM API requests to a malicious endpoint that impersonates the intended service,
      capturing prompts containing source code.
    dread:
      damage: 9
      reproducibility: 3
      exploitability: 5
      affected_users: 8
      discoverability: 4
    severity: high
    mitigations:
      - MIT-001  # LocalOnly mode default
      - MIT-004  # TLS certificate pinning
      - MIT-005  # User consent for Burst mode
    residual_risk: |
      In Burst mode with user consent, if TLS is compromised, risk remains.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-S-002
    category: spoofing
    title: Config file replacement attack
    description: |
      Attacker with file system access replaces .agent/config.yml with malicious
      configuration pointing to attacker-controlled LLM or modifying operating mode.
    dread:
      damage: 8
      reproducibility: 7
      exploitability: 6
      affected_users: 5
      discoverability: 6
    severity: high
    mitigations:
      - MIT-006  # Config file integrity checks
      - MIT-007  # File permissions validation
      - MIT-008  # Audit logging of config changes
    residual_risk: |
      If attacker has filesystem write access, they may have broader compromise capability.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-S-003
    category: spoofing
    title: Dependency confusion attack
    description: |
      Attacker publishes malicious package with same name as internal dependency,
      causing package manager to install malicious version.
    dread:
      damage: 10
      reproducibility: 8
      exploitability: 4
      affected_users: 10
      discoverability: 3
    severity: high
    mitigations:
      - MIT-009  # Package hash verification
      - MIT-010  # Private package registry priority
      - MIT-011  # Dependency pinning in lock files
    residual_risk: |
      Supply chain attacks remain difficult to detect without comprehensive SBOM analysis.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-S-004
    category: spoofing
    title: Process impersonation
    description: |
      Malicious process impersonates Acode CLI to capture user input or credentials.
    dread:
      damage: 7
      reproducibility: 5
      exploitability: 7
      affected_users: 6
      discoverability: 5
    severity: medium
    mitigations:
      - MIT-012  # Code signing
      - MIT-013  # Process integrity verification
      - MIT-014  # User education on verifying process identity
    residual_risk: |
      Users may not verify process identity before providing sensitive input.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-S-005
    category: spoofing
    title: Git remote impersonation
    description: |
      Attacker modifies .git/config to point to malicious remote, exfiltrating code during push/pull.
    dread:
      damage: 9
      reproducibility: 6
      exploitability: 6
      affected_users: 7
      discoverability: 4
    severity: high
    mitigations:
      - MIT-015  # .git/ protected path
      - MIT-016  # Remote URL validation before operations
      - MIT-017  # Audit logging of git operations
    residual_risk: |
      If .git/ protection is bypassed, repository integrity is compromised.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-S-006
    category: spoofing
    title: User identity spoofing in audit logs
    description: |
      If audit logs don't capture true user identity, attacker actions may be attributed to legitimate user.
    dread:
      damage: 6
      reproducibility: 4
      exploitability: 6
      affected_users: 8
      discoverability: 7
    severity: medium
    mitigations:
      - MIT-018  # Session ID and correlation ID in all audit events
      - MIT-019  # Operating system user context capture
      - MIT-020  # Tamper-evident audit logs
    residual_risk: |
      User identity spoofing at OS level (su, sudo) may still attribute actions incorrectly.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  # ===================================================================
  # TAMPERING RISKS (RISK-T-001 to RISK-T-007)
  # ===================================================================

  - id: RISK-T-001
    category: tampering
    title: Source code modification by malicious LLM response
    description: |
      LLM response contains malicious code that, when applied by Acode, introduces
      backdoors, vulnerabilities, or data exfiltration into the codebase.
    dread:
      damage: 10
      reproducibility: 7
      exploitability: 5
      affected_users: 10
      discoverability: 3
    severity: high
    mitigations:
      - MIT-021  # Output sanitization and validation
      - MIT-022  # User review before applying changes
      - MIT-023  # Static analysis on proposed changes
      - MIT-024  # Git worktree isolation
    residual_risk: |
      Subtle malicious code may pass review and static analysis.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-T-002
    category: tampering
    title: Audit log tampering
    description: |
      Attacker with file system access modifies or deletes audit logs to hide malicious activity.
    dread:
      damage: 8
      reproducibility: 8
      exploitability: 5
      affected_users: 10
      discoverability: 6
    severity: high
    mitigations:
      - MIT-020  # Tamper-evident logs (checksums)
      - MIT-025  # Append-only log files
      - MIT-026  # File system permissions on audit logs
      - MIT-027  # Remote log shipping (optional, conflicts with LocalOnly)
    residual_risk: |
      Root/admin access allows log deletion. Remote shipping conflicts with LocalOnly mode.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-T-003
    category: tampering
    title: Configuration tampering to disable security controls
    description: |
      Attacker modifies .agent/config.yml to disable protected paths, secret redaction, or audit logging.
    dread:
      damage: 9
      reproducibility: 9
      exploitability: 5
      affected_users: 10
      discoverability: 5
    severity: high
    mitigations:
      - MIT-006  # Config integrity checks
      - MIT-028  # Security invariants (cannot be disabled via config)
      - MIT-008  # Audit logging of config changes
    residual_risk: |
      If config validation is bypassed, security controls may be disabled.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-T-004
    category: tampering
    title: Symlink attack to modify protected files
    description: |
      Attacker creates symlink from allowed path to protected path, bypassing path protection.
    dread:
      damage: 9
      reproducibility: 7
      exploitability: 6
      affected_users: 8
      discoverability: 5
    severity: high
    mitigations:
      - MIT-029  # Symlink resolution before path validation
      - MIT-030  # Max symlink depth limit (40)
      - MIT-031  # Circular symlink detection
    residual_risk: |
      Complex symlink chains may be difficult to detect.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-T-005
    category: tampering
    title: Time-of-check to time-of-use (TOCTOU) race
    description: |
      Path is validated as safe, but replaced with malicious file before use.
    dread:
      damage: 7
      reproducibility: 3
      exploitability: 8
      affected_users: 6
      discoverability: 2
    severity: medium
    mitigations:
      - MIT-032  # Atomic file operations where possible
      - MIT-033  # Re-validation immediately before use
      - MIT-034  # File handle caching
    residual_risk: |
      TOCTOU is inherently difficult to eliminate completely.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-T-006
    category: tampering
    title: Environment variable injection
    description: |
      Attacker modifies environment variables to influence Acode behavior (PATH, LD_PRELOAD, etc.).
    dread:
      damage: 8
      reproducibility: 6
      exploitability: 6
      affected_users: 7
      discoverability: 5
    severity: high
    mitigations:
      - MIT-035  # Environment variable sanitization
      - MIT-036  # Explicit PATH for spawned processes
      - MIT-037  # Audit logging of environment at startup
    residual_risk: |
      LD_PRELOAD and similar attacks may bypass application-level controls.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-T-007
    category: tampering
    title: Binary tampering via package manager
    description: |
      Attacker compromises package manager to deliver tampered Acode binaries.
    dread:
      damage: 10
      reproducibility: 4
      exploitability: 3
      affected_users: 10
      discoverability: 2
    severity: high
    mitigations:
      - MIT-038  # Binary code signing
      - MIT-039  # Package checksum verification
      - MIT-040  # Software Bill of Materials (SBOM)
      - MIT-041  # Reproducible builds
    residual_risk: |
      Supply chain attacks on distribution infrastructure are difficult to prevent.
    owner: release-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  # ===================================================================
  # REPUDIATION RISKS (RISK-R-001 to RISK-R-005)
  # ===================================================================

  - id: RISK-R-001
    category: repudiation
    title: Unlogged file modifications
    description: |
      File modifications occur without audit logging, preventing attribution of changes.
    dread:
      damage: 6
      reproducibility: 8
      exploitability: 5
      affected_users: 9
      discoverability: 7
    severity: medium
    mitigations:
      - MIT-042  # Comprehensive file operation logging
      - MIT-043  # Git integration for change tracking
      - MIT-044  # Mandatory audit logging (cannot be disabled)
    residual_risk: |
      File system level changes (outside Acode) won't be logged.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-R-002
    category: repudiation
    title: Unlogged command execution
    description: |
      Commands executed by Acode are not logged, preventing accountability for malicious commands.
    dread:
      damage: 8
      reproducibility: 8
      exploitability: 5
      affected_users: 9
      discoverability: 7
    severity: high
    mitigations:
      - MIT-045  # Command execution audit logging
      - MIT-046  # Command output capture in audit logs
      - MIT-047  # Exit code logging
    residual_risk: |
      Commands run outside Acode control won't be logged.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-R-003
    category: repudiation
    title: Unlogged operating mode changes
    description: |
      Operating mode changes (LocalOnly â†’ Burst) are not logged, hiding security policy violations.
    dread:
      damage: 7
      reproducibility: 9
      exploitability: 4
      affected_users: 10
      discoverability: 8
    severity: high
    mitigations:
      - MIT-048  # Operating mode change audit logging
      - MIT-049  # User consent required with explicit logging
      - MIT-050  # Mode transitions subject to approval workflow
    residual_risk: |
      Config file edits may change mode without triggering logging if done outside Acode.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-R-004
    category: repudiation
    title: Unlogged external API calls
    description: |
      In Burst mode, external API calls (to LLMs) are not logged, hiding data exfiltration.
    dread:
      damage: 9
      reproducibility: 7
      exploitability: 5
      affected_users: 8
      discoverability: 6
    severity: high
    mitigations:
      - MIT-051  # LLM API call audit logging
      - MIT-052  # Prompt and response logging (with redaction)
      - MIT-053  # Network traffic monitoring (optional)
    residual_risk: |
      Network-level exfiltration may bypass application logging.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-R-005
    category: repudiation
    title: Audit log deletion
    description: |
      Attacker deletes audit logs to hide malicious activity after the fact.
    dread:
      damage: 8
      reproducibility: 8
      exploitability: 5
      affected_users: 10
      discoverability: 6
    severity: high
    mitigations:
      - MIT-020  # Tamper-evident logs
      - MIT-025  # Append-only file mode
      - MIT-026  # File system permissions
      - MIT-054  # Log deletion attempts logged to separate log
    residual_risk: |
      Root/admin access can delete all logs.
    owner: audit-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  # ===================================================================
  # INFORMATION DISCLOSURE RISKS (RISK-I-001 to RISK-I-010)
  # ===================================================================

  - id: RISK-I-001
    category: information_disclosure
    title: Source code exfiltration via external LLM
    description: |
      In Burst mode, source code sent as context to external LLM could be stored,
      logged, or used for training, violating intellectual property.
    dread:
      damage: 9
      reproducibility: 10
      exploitability: 3
      affected_users: 10
      discoverability: 7
    severity: high
    mitigations:
      - MIT-001  # LocalOnly mode default
      - MIT-005  # User consent for Burst mode
      - MIT-055  # Data classification and labeling
      - MIT-056  # Prompt minimization (send only necessary context)
    residual_risk: |
      In Burst mode with user consent, code is intentionally sent externally.
      Users must understand and accept this risk.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-002
    category: information_disclosure
    title: Secrets in audit logs
    description: |
      API keys, passwords, or tokens appear in audit logs due to insufficient redaction.
    dread:
      damage: 10
      reproducibility: 6
      exploitability: 4
      affected_users: 9
      discoverability: 5
    severity: high
    mitigations:
      - MIT-057  # Secret redaction before logging
      - MIT-058  # Regex-based secret detection
      - MIT-059  # Manual secret redaction in structured logs
    residual_risk: |
      Novel secret formats may not match redaction patterns.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-003
    category: information_disclosure
    title: Secrets in LLM prompts
    description: |
      Secrets inadvertently included in code sent to LLM as context, exposing credentials.
    dread:
      damage: 10
      reproducibility: 7
      exploitability: 4
      affected_users: 8
      discoverability: 6
    severity: high
    mitigations:
      - MIT-057  # Secret redaction before LLM prompts
      - MIT-060  # Pre-flight secret scan on context
      - MIT-061  # Protected path enforcement (prevents reading secret files)
    residual_risk: |
      Secrets hardcoded in source may not be detected by pattern matching.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-004
    category: information_disclosure
    title: Verbose error messages expose sensitive details
    description: |
      Error messages contain file paths, usernames, or stack traces revealing system internals.
    dread:
      damage: 5
      reproducibility: 9
      exploitability: 6
      affected_users: 7
      discoverability: 8
    severity: medium
    mitigations:
      - MIT-062  # Safe error message formatting
      - MIT-063  # Path normalization in errors
      - MIT-064  # Detailed errors only in debug mode
    residual_risk: |
      Stack traces may still reveal framework internals.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-005
    category: information_disclosure
    title: Config file exposure
    description: |
      .agent/config.yml contains sensitive settings or paths that reveal system topology.
    dread:
      damage: 6
      reproducibility: 8
      exploitability: 5
      affected_users: 8
      discoverability: 7
    severity: medium
    mitigations:
      - MIT-065  # File permissions on .agent/ directory (600/700)
      - MIT-066  # Config validation rejects sensitive fields
      - MIT-067  # Audit logging of config access
    residual_risk: |
      Config files inherently contain some system information.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-006
    category: information_disclosure
    title: Temporary files contain secrets
    description: |
      Temporary files created during operation contain secrets that persist after process exit.
    dread:
      damage: 9
      reproducibility: 5
      exploitability: 6
      affected_users: 7
      discoverability: 4
    severity: high
    mitigations:
      - MIT-068  # Secure temp file creation (mode 600)
      - MIT-069  # Immediate deletion of temp files
      - MIT-070  # Secret-free temp file design
    residual_risk: |
      Process crash may leave temp files undeleted.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-007
    category: information_disclosure
    title: Memory dump contains secrets
    description: |
      Core dump or crash dump contains secrets from process memory.
    dread:
      damage: 9
      reproducibility: 3
      exploitability: 7
      affected_users: 6
      discoverability: 3
    severity: medium
    mitigations:
      - MIT-071  # Disable core dumps in production
      - MIT-072  # Zero memory for secrets after use
      - MIT-073  # SecureString types for credentials (language-dependent)
    residual_risk: |
      Operating system may override application core dump settings.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-008
    category: information_disclosure
    title: Path disclosure reveals system topology
    description: |
      File paths in logs/errors reveal usernames, directory structure, or OS type.
    dread:
      damage: 4
      reproducibility: 10
      exploitability: 7
      affected_users: 8
      discoverability: 9
    severity: low
    mitigations:
      - MIT-074  # Path normalization (replace home with ~)
      - MIT-075  # Relative paths in output
      - MIT-076  # Path redaction in public logs
    residual_risk: |
      Some path disclosure is necessary for debugging.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-009
    category: information_disclosure
    title: Version information disclosure
    description: |
      Software version in error messages or headers enables targeted exploitation.
    dread:
      damage: 5
      reproducibility: 10
      exploitability: 6
      affected_users: 10
      discoverability: 10
    severity: low
    mitigations:
      - MIT-077  # Generic version strings in public output
      - MIT-078  # Detailed version only in authenticated contexts
      - MIT-079  # Rapid patching to minimize exposure window
    residual_risk: |
      Version information is useful for support and debugging.
    owner: product-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-I-010
    category: information_disclosure
    title: LLM training data leakage
    description: |
      External LLM trained on data sent in Burst mode, leaking information to other users.
    dread:
      damage: 8
      reproducibility: 5
      exploitability: 3
      affected_users: 10
      discoverability: 2
    severity: high
    mitigations:
      - MIT-001  # LocalOnly mode default
      - MIT-080  # Data usage agreements with LLM providers
      - MIT-081  # User consent with explicit warning
      - MIT-082  # Prefer providers with no-training guarantees
    residual_risk: |
      Cannot verify external LLM provider compliance with data usage policies.
    owner: legal-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  # ===================================================================
  # DENIAL OF SERVICE RISKS (RISK-D-001 to RISK-D-007)
  # ===================================================================

  - id: RISK-D-001
    category: denial_of_service
    title: Infinite loop in LLM-generated code
    description: |
      LLM generates code with infinite loop, causing Acode process to hang.
    dread:
      damage: 5
      reproducibility: 6
      exploitability: 7
      affected_users: 7
      discoverability: 8
    severity: medium
    mitigations:
      - MIT-083  # Command execution timeout (5 minutes default)
      - MIT-084  # User review before execution
      - MIT-085  # Static analysis for obvious infinite loops
    residual_risk: |
      Complex infinite loops difficult to detect statically.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-D-002
    category: denial_of_service
    title: Resource exhaustion via large files
    description: |
      Acode attempts to read/process extremely large file, exhausting memory.
    dread:
      damage: 6
      reproducibility: 9
      exploitability: 5
      affected_users: 8
      discoverability: 7
    severity: medium
    mitigations:
      - MIT-086  # File size limit (10 MB default)
      - MIT-087  # Streaming file processing
      - MIT-088  # Memory monitoring and limits
    residual_risk: |
      Legitimate large files may need processing.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-D-003
    category: denial_of_service
    title: Memory exhaustion via LLM prompts
    description: |
      Extremely large context sent to LLM exhausts available memory.
    dread:
      damage: 6
      reproducibility: 7
      exploitability: 6
      affected_users: 8
      discoverability: 6
    severity: medium
    mitigations:
      - MIT-089  # Context size limits
      - MIT-090  # Token budgeting
      - MIT-088  # Memory monitoring
    residual_risk: |
      Large codebases may legitimately need large context.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-D-004
    category: denial_of_service
    title: Disk exhaustion via audit logs
    description: |
      Excessive audit logging fills disk, preventing further operation.
    dread:
      damage: 7
      reproducibility: 8
      exploitability: 5
      affected_users: 9
      discoverability: 7
    severity: medium
    mitigations:
      - MIT-091  # Log rotation policy
      - MIT-092  # Disk space monitoring
      - MIT-093  # Fail-closed when disk full (halt operations)
      - MIT-094  # Configurable log retention period
    residual_risk: |
      Disk full is always possible with sufficient activity.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-D-005
    category: denial_of_service
    title: CPU exhaustion via regex
    description: |
      Maliciously crafted input causes catastrophic regex backtracking, consuming CPU.
    dread:
      damage: 6
      reproducibility: 5
      exploitability: 7
      affected_users: 7
      discoverability: 4
    severity: medium
    mitigations:
      - MIT-095  # Regex timeout limits
      - MIT-096  # Static regex analysis (ReDoS detection)
      - MIT-097  # Use compiled/non-backtracking regex where possible
    residual_risk: |
      Novel ReDoS patterns may bypass detection.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-D-006
    category: denial_of_service
    title: Process fork bomb
    description: |
      LLM-generated code or config causes Acode to spawn unbounded processes.
    dread:
      damage: 8
      reproducibility: 6
      exploitability: 6
      affected_users: 7
      discoverability: 5
    severity: high
    mitigations:
      - MIT-098  # Process limit enforcement (ulimit/job control)
      - MIT-099  # Command whitelist
      - MIT-100  # User review of process-spawning commands
    residual_risk: |
      Operating system limits may be too high to prevent DoS.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-D-007
    category: denial_of_service
    title: Network flooding in Burst mode
    description: |
      Excessive API calls to external LLM in Burst mode exhaust rate limits or bandwidth.
    dread:
      damage: 5
      reproducibility: 7
      exploitability: 6
      affected_users: 6
      discoverability: 7
    severity: low
    mitigations:
      - MIT-101  # Rate limiting on outbound API calls
      - MIT-102  # Request batching and caching
      - MIT-103  # Circuit breaker pattern for API failures
    residual_risk: |
      External API rate limits enforced by provider, not under our control.
    owner: engineering-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  # ===================================================================
  # ELEVATION OF PRIVILEGE RISKS (RISK-E-001 to RISK-E-007)
  # ===================================================================

  - id: RISK-E-001
    category: elevation_of_privilege
    title: Config-driven arbitrary code execution
    description: |
      Malicious .agent/config.yml contains code execution payloads via YAML deserialization or command injection.
    dread:
      damage: 10
      reproducibility: 8
      exploitability: 5
      affected_users: 10
      discoverability: 5
    severity: high
    mitigations:
      - MIT-104  # Safe YAML parsing (no arbitrary object deserialization)
      - MIT-105  # JSON schema validation
      - MIT-106  # Command whitelist for allowed operations
      - MIT-107  # Input sanitization for all config values
    residual_risk: |
      If config parser has vulnerabilities, arbitrary code execution possible.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-E-002
    category: elevation_of_privilege
    title: Prompt injection to command execution
    description: |
      Attacker embeds malicious instructions in source code comments/strings that LLM interprets
      as commands, causing Acode to execute unintended actions.
    dread:
      damage: 9
      reproducibility: 6
      exploitability: 7
      affected_users: 9
      discoverability: 4
    severity: high
    mitigations:
      - MIT-108  # Output sanitization
      - MIT-109  # User review before command execution
      - MIT-110  # Prompt engineering to resist injection
      - MIT-111  # Sandboxing for LLM-generated code
    residual_risk: |
      Prompt injection attacks continually evolve; detection is difficult.
    owner: ai-safety-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-E-003
    category: elevation_of_privilege
    title: Path traversal to system files
    description: |
      Attacker crafts path with ../ sequences to escape repository and access system files.
    dread:
      damage: 10
      reproducibility: 9
      exploitability: 6
      affected_users: 10
      discoverability: 7
    severity: high
    mitigations:
      - MIT-112  # Path normalization and canonicalization
      - MIT-113  # Protected path denylist enforcement
      - MIT-114  # Repository root boundary enforcement
      - MIT-115  # Audit logging of path access attempts
    residual_risk: |
      Novel path traversal techniques may bypass validation.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-E-004
    category: elevation_of_privilege
    title: Symlink following to protected areas
    description: |
      Symlink from allowed path to system file bypasses path protection via TOCTOU.
    dread:
      damage: 9
      reproducibility: 7
      exploitability: 6
      affected_users: 8
      discoverability: 5
    severity: high
    mitigations:
      - MIT-029  # Symlink resolution before validation
      - MIT-030  # Max symlink depth
      - MIT-116  # Symlink following disabled for sensitive operations
    residual_risk: |
      Complex symlink chains may evade detection.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-E-005
    category: elevation_of_privilege
    title: YAML deserialization attacks
    description: |
      Malicious YAML config contains gadget chains leading to arbitrary code execution.
    dread:
      damage: 10
      reproducibility: 6
      exploitability: 4
      affected_users: 10
      discoverability: 3
    severity: high
    mitigations:
      - MIT-104  # Safe YAML parsing library
      - MIT-117  # Disable dangerous YAML features (anchors, merge keys, etc.)
      - MIT-118  # Schema enforcement before deserialization
    residual_risk: |
      YAML deserialization vulnerabilities are complex and evolving.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-E-006
    category: elevation_of_privilege
    title: Operating mode bypass
    description: |
      Attacker bypasses LocalOnly mode to enable Burst mode without user consent.
    dread:
      damage: 9
      reproducibility: 5
      exploitability: 5
      affected_users: 10
      discoverability: 4
    severity: high
    mitigations:
      - MIT-119  # Mode enforcement at multiple layers
      - MIT-120  # User consent workflow with explicit confirmation
      - MIT-048  # Audit logging of mode changes
      - MIT-121  # Code review of mode transition logic
    residual_risk: |
      Implementation bugs may allow mode bypass.
    owner: security-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

  - id: RISK-E-007
    category: elevation_of_privilege
    title: Dependency confusion leading to code execution
    description: |
      Malicious package installed via dependency confusion executes arbitrary code during Acode operation.
    dread:
      damage: 10
      reproducibility: 6
      exploitability: 4
      affected_users: 10
      discoverability: 3
    severity: high
    mitigations:
      - MIT-009  # Package hash verification
      - MIT-122  # Package source validation
      - MIT-123  # SBOM generation and monitoring
      - MIT-124  # Package sandboxing
    residual_risk: |
      Supply chain attacks remain difficult to prevent completely.
    owner: infrastructure-team
    status: active
    created: "2026-01-03"
    last_review: "2026-01-03"

# ===================================================================
# MITIGATIONS
# ===================================================================

mitigations:
  - id: MIT-001
    title: LocalOnly operating mode default
    description: External LLM API calls disabled by default, requiring explicit user opt-in for Burst mode.
    implementation: |
      src/Acode.Domain/OperatingMode/OperatingMode.cs
      Default value: LocalOnly
    verification: unit_test:OperatingModeTests.Default_Is_LocalOnly
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-004
    title: TLS certificate pinning for external LLM connections
    description: Verify external LLM TLS certificates against known pins to prevent MITM.
    implementation: Future (Epic 1 - Model Runtime)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-005
    title: User consent workflow for Burst mode
    description: Explicit user confirmation required before enabling Burst mode.
    implementation: Future (Epic 2 - CLI)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-006
    title: Config file integrity checks
    description: Validate config file hash/signature before loading.
    implementation: Future (Task 002 enhancement)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-007
    title: File permissions validation on config files
    description: Verify .agent/config.yml is not world-writable.
    implementation: Future (Task 002 enhancement)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-008
    title: Audit logging of configuration changes
    description: Log all modifications to .agent/config.yml with timestamp and user.
    implementation: |
      src/Acode.Infrastructure/Audit/JsonAuditLogger.cs
      Event: ConfigChange
    verification: integration_test:ConfigChangeLogged
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-015
    title: .git/ protected path enforcement
    description: .git/ directory on denylist, preventing read/write access.
    implementation: |
      src/Acode.Domain/Security/PathProtection/DefaultDenylist.cs
      Pattern: .git/
    verification: unit_test:DefaultDenylistTests.Git_Directory_Protected
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-020
    title: Tamper-evident audit logs
    description: Append-only logs with integrity checksums.
    implementation: |
      src/Acode.Infrastructure/Audit/JsonAuditLogger.cs
      Append-only file mode, future: checksums
    verification: integration_test:AuditLogTamperDetection
    status: in_progress
    last_verified: "2026-01-03"

  - id: MIT-021
    title: Output sanitization and validation
    description: Validate LLM responses before applying changes.
    implementation: Future (Epic 2 - Agent Orchestration)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-028
    title: Security invariants cannot be disabled
    description: Protected paths, audit logging cannot be disabled via config.
    implementation: |
      Design principle: Security controls in code, not config.
      Config can add paths, not remove from denylist.
    verification: design_review:SecurityInvariants
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-029
    title: Symlink resolution before path validation
    description: Resolve all symlinks to canonical paths before checking denylist.
    implementation: |
      src/Acode.Infrastructure/Security/ProtectedPathValidator.cs
      Future enhancement: Path.GetFullPath with symlink resolution
    verification: unit_test:PathValidator_Symlink_Resolution
    status: pending
    last_verified: null

  - id: MIT-042
    title: Comprehensive file operation logging
    description: Log all file read/write/delete operations with path and result.
    implementation: Future (Epic 2 - Core + Audit integration)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-057
    title: Secret redaction before logging
    description: Detect and redact secrets using regex patterns before writing to audit logs.
    implementation: |
      src/Acode.Infrastructure/Security/RegexSecretRedactor.cs
      Patterns: password, api_key, token, secret, private_key
    verification: unit_test:RegexSecretRedactorTests
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-061
    title: Protected path enforcement prevents reading secret files
    description: Denylist blocks access to credential files (SSH keys, AWS credentials, etc.).
    implementation: |
      src/Acode.Domain/Security/PathProtection/DefaultDenylist.cs
      45 protected path patterns across 7 categories
    verification: unit_test:DefaultDenylistTests
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-083
    title: Command execution timeout
    description: All spawned processes have 5-minute timeout by default.
    implementation: Future (Epic 4 - Execution & Sandboxing)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-086
    title: File size limit enforcement
    description: Reject files larger than 10 MB by default.
    implementation: Future (Epic 3 - Repo Intelligence)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-091
    title: Audit log rotation policy
    description: Rotate audit logs daily or at 100 MB, retain for 90 days.
    implementation: Future (Task 003c - Audit Baseline)
    verification: null
    status: pending
    last_verified: null

  - id: MIT-104
    title: Safe YAML parsing with no object deserialization
    description: Use YAML parser that only deserializes to primitives, no arbitrary types.
    implementation: |
      src/Acode.Infrastructure/Configuration/YamlConfigReader.cs
      YamlDotNet with SafeMode enabled
    verification: unit_test:YamlConfigReaderTests.Deserialization_Attack_Blocked
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-105
    title: JSON schema validation on config
    description: Validate .agent/config.yml against schema before processing.
    implementation: |
      src/Acode.Infrastructure/Configuration/JsonSchemaValidator.cs
      data/config-schema.json
    verification: integration_test:ConfigE2ETests.Schema_Validation
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-112
    title: Path normalization and canonicalization
    description: Convert all paths to absolute canonical form before validation.
    implementation: |
      src/Acode.Infrastructure/Security/ProtectedPathValidator.cs
      Path normalization with separator replacement
    verification: unit_test:ProtectedPathValidatorTests
    status: implemented
    last_verified: "2026-01-03"

  - id: MIT-113
    title: Protected path denylist enforcement
    description: Block access to 45 protected path patterns.
    implementation: |
      src/Acode.Domain/Security/PathProtection/DefaultDenylist.cs
      src/Acode.Infrastructure/Security/ProtectedPathValidator.cs
    verification: unit_test:ProtectedPathValidatorTests
    status: implemented
    last_verified: "2026-01-03"

# ===================================================================
# RISK SUMMARY
# ===================================================================

summary:
  total_risks: 41
  by_category:
    spoofing: 6
    tampering: 7
    repudiation: 5
    information_disclosure: 10
    denial_of_service: 7
    elevation_of_privilege: 7
  by_severity:
    high: 27
    medium: 12
    low: 2
  total_mitigations: 24
  mitigations_implemented: 10
  mitigations_in_progress: 1
  mitigations_pending: 13
